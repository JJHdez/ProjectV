<!--
    Copyright 2017 ProjectV Authors. All Rights Reserved.

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->
{% extends "layout.html" %}
{% block layout_title %}
    Proyectos
{% endblock %}
{% block body %}
    <div class="mdl-grid">
        <div id="projects-panel"
             class="mdl-cell mdl-cell--12-col mdl-grid mdl-grid--no-spacing">

            <div class="mdl-cell
                mdl-cell--4-col
                mdl-cell--4-col-tablet mdl-cell--4-col-desktop
                mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                <input v-model="workspaceModelQuickAdd.name"
                       @keyup.enter="accept(true)"
                       class="mdl-textfield__input" type="text" id="workspace-name-quick">
                <label class="mdl-textfield__label" for="workspace-name-quick">Workspace</label>
            </div>

            <div class="mdl-cell mdl-cell--4-col mdl-cell--4-col-tablet mdl-cell--8-col-desktop">
                <span v-for="(project, index) in projects"
                        v-bind:class="activeWorkspace(project, index)">
                    <img v-on:click="viewTask(project,index)"
                         class="mdl-chip__contact" src="https://getmdl.io/templates/dashboard/images/user.jpg"/>
                    <span v-on:click="viewTask(project,index)" class="mdl-chip__text">
                        ${project.name}
                    </span>
                    <a class="mdl-chip__action" v-on:click="edit(project,index)">
                        <i class="material-icons">edit</i>
                    </a>
                </span>
            </div>

            <dialog id="project-dialog" class="mdl-dialog mdl-cell--4-col">
                <div class="mdl-card__menu">
                    <button v-show="validation.workspaceRemove"
                        v-on:click="remove()"
                        class="mdl-button mdl-js-button mdl-button--icon">
                    <i class="material-icons mdl-color-text--red">
                        delete_forever
                    </i>
                    </button>
                        <button
                            v-on:click="done()"
                            class="mdl-button mdl-js-button mdl-button--icon">
                        <i class="material-icons mdl-color-text--light-green">
                            done
                        </i>
                    </button>
                </div>
                <h4 class="mdl-dialog__title">
                    <i class="material-icons">widgets</i>
                    Proyecto
                </h4>

                <div class="mdl-dialog__content">
                    <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                        <input class="mdl-textfield__input" type="text" id="project-name"
                               v-model="projectModel.name" required>
                        <label class="mdl-textfield__label" for="project-name">Nombre</label>
                    </div>
                </div>

                <div class="mdl-dialog__actions">
                    <button v-show="validation.workspaceEdit"
                            v-on:click="accept(false)"
                            class="mdl-button mdl-js-button mdl-button--raised
                                mdl-js-ripple-effect mdl-button--colored">
                        <i class="material-icons">check_circle</i>Aceptar
                    </button>
                    <button
                            v-on:click="closeDialog()"
                            class="mdl-button mdl-js-button mdl-button--raised
                            mdl-js-ripple-effect mdl-button--accent"
                            id="project-dialog-cancel">
                        <i class="material-icons">cancel</i>Cancelar
                    </button>
                </div>
            </dialog>

        </div>

        <div id="project-tasks-panel" class="mdl-cell mdl-cell--12-col mdl-grid mdl-grid--no-spacing">

            <ul class="mdl-list mdl-cell mdl-cell--3-col">
                <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                    <input @keyup.enter="acceptSubTask(getGroupTaskByName('Today'), -1, true)"
                           v-model="taskTodayModel.name"
                           class="mdl-textfield__input" type="text" id="sub-task-name-today-quick">
                    <label class="mdl-textfield__label" for="sub-task-name-today-quick">Today</label>
                </div>
                <draggable v-model="tasksToday" :options="{group:'task'}">
                    <li  v-for="(task, index) in tasksToday"
                          v-on:click="openDialogTask(task,index,'Today')"
                         class="mdl-list__item mdl-shadow--2dp">
                        <span class="mdl-list__item-primary-content">
                            <img class="mdl-chip__contact"
                                 src="https://getmdl.io/templates/dashboard/images/user.jpg"/>
                            ${task.name}
                        </span>
                        <span class="mdl-list__item-secondary-content">
                            <div>
                                <a class="mdl-list__item-secondary-action" href="#">
                                    <i v-bind:class="getTaskIconColourByName('Today')">${getTaskIconByName('Today')}</i>
                                </a>
                            </div>
                        </span>
                    </li>
                </draggable>
            </ul>

            <ul class="mdl-list mdl-cell mdl-cell--3-col">
                <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                    <input @keyup.enter="acceptSubTask(getGroupTaskByName('Tomorrow'), -1,true)"
                           v-model="taskTomorrowModel.name"
                           class="mdl-textfield__input" type="text" id="sub-task-name-tomorrow-quick">
                    <label class="mdl-textfield__label" for="sub-task-name-tomorrow-quick">Tomorrow</label>
                </div>
                <draggable v-model="tasksTomorrow" :options="{group:'task'}">
                    <li  v-for="task in tasksTomorrow" class="mdl-list__item mdl-shadow--2dp">
                        <span class="mdl-list__item-primary-content">
                             <img class="mdl-chip__contact" src="https://getmdl.io/templates/dashboard/images/user.jpg"/>
                            ${task.name}
                        </span>
                        <span class="mdl-list__item-secondary-content">
                            <div>
                                <a class="mdl-list__item-secondary-action" href="#">
                                    <i v-bind:class="getTaskIconColourByName('Tomorrow')">${getTaskIconByName('Tomorrow')}</i>
                                </a>
                            </div>
                        </span>
                    </li>
                </draggable>
            </ul>

            <ul class="mdl-list mdl-cell mdl-cell--3-col">
                <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                    <input @keyup.enter="acceptSubTask(getGroupTaskByName('Upcoming'), -1, true)"
                           v-model="taskUpcomingModel.name"
                           class="mdl-textfield__input" type="text" id="sub-task-name-upcoming-quick">
                    <label class="mdl-textfield__label" for="sub-task-name-upcoming-quick">Upcoming</label>
                </div>
                <draggable v-model="tasksUpcoming" :options="{group:'task'}">
                    <li  v-for="task in tasksUpcoming" class="mdl-list__item mdl-shadow--2dp">
                        <span class="mdl-list__item-primary-content">
                             <img class="mdl-chip__contact" src="https://getmdl.io/templates/dashboard/images/user.jpg"/>
                            ${task.name}
                        </span>
                        <span class="mdl-list__item-secondary-content">
                            <div>
                                <a class="mdl-list__item-secondary-action" href="#">
                                    <i v-bind:class="getTaskIconColourByName('Upcoming')">${getTaskIconByName('Upcoming')}</i>
                                </a>
                            </div>
                        </span>
                    </li>
                </draggable>
            </ul>

            <ul class="mdl-list mdl-cell mdl-cell--3-col">
                <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                    <input @keyup.enter="acceptSubTask(getGroupTaskByName('Someday'), -1, true)"
                           v-model="taskSomedayModel.name"
                           class="mdl-textfield__input" type="text" id="sub-task-name-someday-quick">
                    <label class="mdl-textfield__label" for="sub-task-name-someday-quick">Someday</label>
                </div>
                <draggable v-model="tasksSomeday" :options="{group:'task'}">
                    <li v-for="task in tasksSomeday"  class="mdl-list__item mdl-shadow--2dp">
                        <span class="mdl-list__item-primary-content">
                             <img class="mdl-chip__contact" src="https://getmdl.io/templates/dashboard/images/user.jpg"/>
                            ${task.name}
                        </span>
                        <span class="mdl-list__item-secondary-content">
                            <div>
                                <a class="mdl-list__item-secondary-action" href="#">
                                    <i v-bind:class="getTaskIconColourByName('Someday')">${getTaskIconByName('Someday')}</i>
                                </a>
                            </div>
                        </span>
                    </li>
                </draggable>
            </ul>

            <dialog id="task-dialog" class="mdl-dialog mdl-cell--8-col">
                <div class="mdl-card__menu">
                    <button v-on:click="removeSubTask()"
                            class="mdl-button mdl-js-button mdl-button--icon">
                        <i class="material-icons mdl-color-text--red">
                            delete_forever
                        </i>
                    </button>
                    <button v-on:click="doneSubTask()"
                            class="mdl-button mdl-js-button mdl-button--icon">
                        <i class="material-icons mdl-color-text--light-green">
                            done
                        </i>
                    </button>
                    <button v-show="validation.subTaskEdit"
                            v-on:click="acceptSubTask(null, null, false)"
                            class="mdl-button mdl-js-button mdl-button--icon">
                        <i class="material-icons">
                            save
                        </i>
                    </button>
                </div>
                <div class="mdl-dialog__title">
                    <i class="material-icons">list</i>
                    <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label
                        mdl-cell mdl-cell--6-col">
                        <input v-model="subTaskModel.name"
                               class="mdl-textfield__input" type="text" id="task-name">
                        <label class="mdl-textfield__label" for="task-name">Nombre</label>
                    </div>

                    <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label
                        mdl-cell mdl-cell--3-col">
                        <input v-model="subTaskModel.due_date_at"
                               class="mdl-textfield__input" type="date" id="task-due-date-at">
                        <label class="mdl-textfield__label" for="task-due-date-at">Fecha a finalizar</label>
                    </div>
                </div>
                <div class="mdl-dialog__content">

                    <span class="mdl-list__item-primary-content">
                        <div class="mdl-textfield mdl-js-textfield
                            mdl-textfield--floating-label mdl-cell mdl-cell--4-col">
                            <input  @keyup.enter="acceptIssue(true)"
                                    v-model="issueModel.name"
                                   class="mdl-textfield__input" type="text" id="quick-bug-name">
                            <label class="mdl-textfield__label" for="quick-bug-name">Actividad</label>
                        </div>
                    </span>
                    <div v-for="(issue, index) in issues" class="mdl-list__item">
                        <span class="mdl-list__item-primary-content">
                            <button v-on:click="removeIssue(issue,index)"
                            class="mdl-button mdl-js-button mdl-button--icon">
                                <i class="material-icons mdl-color-text--red">
                                    delete_forever
                                </i>
                            </button>
                          <span>${issue.name}</span>
                        </span>
                        <a class="mdl-list__item-secondary-action" href="#">
                            <button v-on:click="doneIssue(issue,index)"
                            class="mdl-button mdl-js-button mdl-button--icon">
                                <i class="material-icons mdl-color-text--light-green">
                                    done
                                </i>
                            </button>
                        </a>
                    </div>
                </div>

            <div class="mdl-dialog__actions">
            </div>
            </dialog>

        </div>
    </div>
{% endblock %}

{% block js %}
    <script src="/js/project.js" type="application/javascript">
    </script>
    <script src="https://cdn.jsdelivr.net/sortable/1.4.2/Sortable.min.js">
    </script>
    <script src="https://cdn.rawgit.com/David-Desmaisons/Vue.Draggable/master/dist/vuedraggable.min.js">
    </script>
{% endblock %}
